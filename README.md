# ブロードキャスト UDPのサンプル

## 1対1の通信

recv.c<br>
引数にポート番号<br>
1回受信したら、受信内容を出力して終了<br>

$ ./recv 9090

send.c

引数：送信アドレス（リミテッドブロードキャストなら、255.255.255.255）<br>
　　　ポート番号<br>
　　　送信内容（文字列）<br>

$ ./send 255.255.255.255 9090 hello<br>

実行すると、送信内容を5秒毎に送信、無限loop

recvとsendはポート番号を同じにすることだけ注意<br>
ブロードキャストなので、受信者は複数いても、複数が受信する。<br>
（マルチキャストとは別の話）



## マルチキャストの通信
マルチキャストの通信を行うには、マルチキャストグループに参加(JOIN)する必要がある。<br>
ここが、先ほどのブロードキャストとは違うところ。（ブロードキャストしているけど受信者を選べる）

マルチキャストアドレスとは<br>
マルチキャストアドレスは「224.0.0.0〜239.255.255.255」の範囲と決まっています。<br>
「224.0.1.0〜238.255.255.255」まではグローバルアドレスのようにインターネットで使えるアドレスです。<br>
「239.0.0.0〜239.255.255.255」まではプライベートアドレスのように組織内で使われるマルチキャストアドレスです。

m_recv.c<br>
引数に、マルチキャストアドレス　ポート番号<br>

$ ./m_recv 239.1.1.1 9090

事前に、送信側が指定のマルチキャストアドレスで口を開いていないと、初期化でエラーになる。<br>
（指定の受信者しか、受信できない）


m_send.c<br>
引数：マルチキャストアドレス<br>
　　　ポート番号<br>
　　　送信内容（文字列）

プログラム内、40行目でLAN I/FのIPアドレスを直接記述しないといけないので、注意<br>
マルチキャストアドレスは、このIPアドレスと全く関係ない。

$ ./m_send 239.1.1.1 9090 hello

実行すると、送信内容を5秒毎に送信、無限loop<br>


## 同じプログラムで送信/受信を一緒に行う
UDPのブロードキャストで通信を行うアプリを作成していて、送信したデータを同じアプリ自身が受信してしまうのが正しいことなのか。このアプリではQtを使っていたため、作成方法に問題があるのでは、という話と、そもそもブロードキャストなんだから自分自身が受信してもいいのではと意見がわかれた。

試しに送信したらすぐに受信するプログラムを作ってみた。(send_recv.c) すると確かに、送信したものを受信した。結果、ブロードキャストなら送信したものを自分自身も受信してしまうので、区別したい場合は受信側で当該パケットの送信元が自分自身かどうかで識別しないといけない。

